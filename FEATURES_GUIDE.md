# 📋 מדריך תכונות מערכת טיפול

## 🎯 סיכום התכונות החדשות שנוספו

### 1️⃣ **תיקון באגים בסיסיים**
#### תיקון הצגת זמנים
- **בעיה**: היומן הציג 11:00, הדשבורד הציג 09:00
- **פתרון**: הוספת פונקציה `toIsraelTime()` להמרת UTC לזמן ישראל (UTC+2/UTC+3)
- **מיקום**: דשבורד → "פגישות היום"

#### תיקון ייצוא מטופלים
- **בעיה**: שגיאות TypeScript ושמות קבצים בעברית
- **פתרון**: תיקון שמות שדות + שמות קבצים ASCII
- **מיקום**: מטופלים → כפתור "ייצוא" (למעלה מימין)

---

## 📱 **תכונות חדשות שנוספו**

### 2️⃣ **PWA - אפליקציית ווב מתקדמת**
#### מה זה עושה?
- התקנה על מסך הבית (נייד/מחשב)
- עבודה ללא אינטרנט (Offline Mode)
- התראות דחיפה
- מהירות גבוהה (Caching)

#### איך להשתמש?
1. **להתקין באייפון/אנדרואיד**:
   - פתח את האתר בדפדפן
   - לחץ על הכפתור הצף "התקן אפליקציה"
   - או: תפריט דפדפן → "הוסף למסך הבית"

2. **להתקין במחשב**:
   - Chrome/Edge: סמל ההתקנה בשורת הכתובת
   - או: הכפתור הצף באתר

#### מיקום הקבצים:
- `public/manifest.json` - הגדרות PWA
- `public/sw.js` - Service Worker (מנהל את ה-cache)
- `public/offline.html` - עמוד Offline
- `src/hooks/use-pwa.ts` - Hook לניהול PWA
- `src/components/pwa-install-prompt.tsx` - הכפתור הצף

---

### 3️⃣ **תזכורות SMS**
#### מה זה עושה?
- שליחת תזכורות SMS למטופלים לפני פגישות
- התאמה אישית של הודעות
- בחירת זמן השליחה (שעות לפני)

#### איך להגדיר?
**📍 מיקום**: הגדרות → תזכורות SMS

**הגדרות:**
1. **הפעל תזכורות SMS** - הדלק/כבה את המערכת
2. **שעות לפני פגישה** - בחר 1-72 שעות
3. **הודעה מותאמת** - כתוב הודעה עם משתנים:
   - `{שם}` - שם המטופל
   - `{תאריך}` - תאריך הפגישה
   - `{שעה}` - שעת הפגישה
4. **שלח בסופי שבוע** - אפשר/בטל

#### דוגמת הודעה:
```
שלום {שם}, תזכורת לפגישה שלך ביום {תאריך} בשעה {שעה}. נתראה!
```

#### מיקום הקבצים:
- API: `src/app/api/sms/settings/route.ts`
- עמוד הגדרות: `src/app/(dashboard)/dashboard/settings/sms/page.tsx`
- מודל DB: `prisma/schema.prisma` → `SMSSettings`, `SMSReminder`

**⚠️ שים לב**: צריך להוסיף Twilio API Keys להפעלת SMS בפועל

---

### 4️⃣ **טפסי הסכמה + חתימה דיגיטלית**
#### מה זה עושה?
- ניהול טפסי הסכמה למטופלים
- חתימה דיגיטלית (עכבר/מגע)
- תבניות מוכנות (7 סוגים)

#### 7 סוגי טפסים:
1. **הסכם טיפול** - הסכם כללי עם מטופל
2. **הסכמה מדעת** - הסכמה לטיפול ספציפי
3. **הסכם סודיות** - חיסיון מטופל
4. **הסכמה להקלטה** - אישור להקלטת פגישות
5. **הסכמה לטיפול מרחוק** - Zoom/טלפון
6. **הסכמת הורים** - לטיפול בקטינים
7. **טופס מותאם אישית** - כל דבר אחר

#### איך להשתמש?
**📍 מיקום**: טפסי הסכמה (בתפריט "כלים קליניים")

**שלבים:**
1. **ליצור תבנית חדשה**:
   - לחץ "צור תבנית חדשה"
   - בחר סוג טופס
   - כתוב תוכן
   - שמור

2. **לשלוח למטופל**:
   - בחר תבנית
   - שייך למטופל
   - שלח (Email/SMS)

3. **לחתום**:
   - המטופל פותח את הטופס
   - חותם עם העכבר/אצבע
   - שומר

#### מיקום הקבצים:
- API: `src/app/api/consent-forms/route.ts`
- עמוד ניהול: `src/app/(dashboard)/dashboard/consent-forms/page.tsx`
- רכיב חתימה: `src/components/ui/signature-pad.tsx`
- מודל DB: `prisma/schema.prisma` → `ConsentForm`

---

### 5️⃣ **שילוב קופות חולים**
#### מה זה עושה?
- דיווח אוטומטי לקופות חולים
- תמיכה ב-4 קו, מכבי, מאוחדת, לאומית
- כל קופה עם פורמט משלה

#### איך להגדיר?
**📍 מיקום**: הגדרות → קופות חולים

**הגדרות לכל קופה:**

**🟢 כללית:**
- API Key (מכללית)
- קוד מוסד

**🔵 מכבי:**
- API Key (ממכבי)
- קוד ספק

**🟠 מאוחדת:**
- שם משתמש
- סיסמה

**🔴 לאומית:**
- API Key (מלאומית)
- קוד מרפאה

#### איך לשלוח דיווח?
1. סיים פגישה
2. עבור לעמוד הפגישה
3. לחץ "שלח דיווח לקופת חולים"
4. בחר קופה
5. אישור - הדיווח נשלח אוטומטית

#### פורמטים:
- **כללית**: XML
- **מכבי**: JSON
- **מאוחדת**: CSV
- **לאומית**: XML

#### מיקום הקבצים:
- API הגדרות: `src/app/api/health-insurers/settings/route.ts`
- API דיווח: `src/app/api/health-insurers/report/route.ts`
- עמוד הגדרות: `src/app/(dashboard)/dashboard/settings/health-insurers/page.tsx`
- מודל DB: `prisma/schema.prisma` → `InsurerSettings`, `InsurerReport`

---

## 🗂️ **מבנה התפריט המחודש**

### 📂 **ניווט ראשי** (שימוש יומיומי)
1. **דשבורד** - מסך הבית (פגישות היום, סטטיסטיקות)
2. **יומן** - צפייה בלוח שנה, קביעת פגישות
3. **מטופלים** - רשימת כל המטופלים
4. **פגישות** - היסטוריית פגישות, סיכומים
5. **משימות** - רשימת מטלות

### 🩺 **כלים קליניים** (כלים מקצועיים)
1. **הקלטות** - הקלטות פגישות + תמלול AI
2. **שאלונים** - שאלונים פסיכומטריים (SCID-5, BDI-2, וכו')
3. **טפסי הסכמה** - ניהול הסכמות + חתימה דיגיטלית
4. **מסמכים** - מסמכים של מטופלים

### 💼 **ניהול עסקי** (כסף וביורוקרטיה)
1. **תשלומים** - חשבוניות, תשלומים
2. **בקשות ביטול** - ניהול ביטולי פגישות (עם Badge מונה)
3. **דוחות** - דוחות כספיים וסטטיסטיים

### ⚙️ **הגדרות**
1. **התראות** - Email/Push notifications
2. **תזכורות SMS** - הגדרות SMS למטופלים
3. **ק חולים** - שילוב עם קית, מכבי, מאוחדת, לאומית)
4. **הגדרות כלליות** - פרופיל, העדפות

### 👑 **מנהל** (רק למנהלים)
- ניהול משתמשים, הרשאות, מערכת

---

## 🗄️ **מבנה מסד הנתונים החדש**

### טבלאות שנוספו:

#### **SMSSettings**
```prisma
- enabled: Boolean (הפעל/כבה)
- hoursBeforeReminder: Int (שעות לפני)
- customMessage: String (הודעה מותאמת)
- sendOnWeekends: Boolean (שלח בסופ"ש)
- therapistId: String (קשר למטפל)
```

#### **SMSReminder**
```prisma
- phoneNumber: String
- message: String
- scheduledFor: DateTime
- sentAt: DateTime?
- status: SMSStatus (PENDING/SENT/FAILED)
- sessionId: String
```

#### **ConsentForm**
```prisma
- type: ConsentType (סוג טופס)
- title: String
- content: String (תוכן HTML)
- isTemplate: Boolean
- signedAt: DateTime?
- signatureData: String? (חתימה Base64)
- clientId: String?
- therapistId: String
```

#### **InsurerSettings**
```prisma
- enabled: Boolean
- clalitEnabled/ApiKey/FacilityId
- maccabiEnabled/ApiKey/ProviderId
- meuhedetEnabled/Username/Password
- leumitEnabled/ApiKey/ClinicCode
- autoSubmit: Boolean
- therapistId: String
```

#### **InsurerReport**
```prisma
- insurer: HealthInsurer (CLALIT/MACCABI/MEUHEDET/LEUMIT)
- reportData: String (JSON)
- status: ReportStatus
- submittedAt: DateTime?
- confirmationCode: String?
- sessionId: String
- therapistId: String
```

---

## 🎨 **עקרונות UX/UI**

### ✅ מה שונה?
1. **ארגון הגיוני** - חלוקה ל-4 קטגוריות ברורות
2. **גישה מהירה** - הפונקציות הנפוצות בראש התפריט
3. **סדר לפי תדירות שימוש**:
   - יומיומי → ראשי
   - שבועי → כלים קליניים
   - חודשי → ניהול עסקי
   - נדיר → הגדרות

4. **הפרדה ברורה**:
   - 🏥 קליני (מטופלים, פגישות, שאלונים)
   - 💰 עסקי (כסף, דוחות)
   - ⚙️ מערכת (הגדרות, תצורה)

5. **אינדיקטורים חזותיים**:
   - Badge אדום על "בקשות ביטול" עם מספר
   - צבע כתום למנהלים
   - אייקונים ברורים לכל פונקציה

---

## 📊 **זרימת עבודה מומלצת**

### 🌅 **בוקר**
1. היכנס ל**דשבורד** - ראה "פגישות היום"
2. בדוק **משימות** - מה צריך לעשות
3. עבור ל**יומן** - תכנן את היום

### 👨‍⚕️ **במהלך היום**
1. **פגישה עם מטופל**:
   - היכנס ל**יומן** → לחץ על הפגישה
   - סמן "הגעתי" (מעבר ל-COMPLETED)
   - הקלט עם **הקלטות** (אם רוצה)
   - כתוב סיכום ב**פגישות**

2. **מטופל חדש**:
   - **מטופלים** → "מטופל חדש"
   - מלא פרטים
   - שלח **טפסי הסכמה**
   - תזמן פגישה ראשונה ב**יומן**

3. **קבלת תשלום**:
   - **תשלומים** → סמן "שולם"
   - או: תשלום מהיר מעמוד הפגישה

### 🌙 **ערב**
1. **דוחות** - סקירה יומית
2. **משימות** - סגור מה שנגמר
3. **בקשות ביטול** - טפל בביטולים

### 📅 **אחת לשבוע**
- **שאלונים** - שלח למטופלים שצריך
- **מסמכים** - עדכן תיקים
- **תזכורות SMS** - בדוק שהכל עובד

### 📆 **אחת לחודש**
- **דוחות** - דוחות חודשיים
- **קופות חולים** - וודא שכל הדיווחים נשלחו
- **הגדרות** - עדכן העדפות

---

## 🔐 **אבטחה ופרטיות**

### 🛡️ מה מוגן?
1. **חתימות דיגיטליות** - שמורות כ-Base64 מוצפן
2. **API Keys קופות חולים** - מוצפנים ב-DB
3. **הקלטות** - גישה רק למטפל הרלוונטי
4. **טפסי הסכמה** - חתימה + תאריך

### 🔒 הרשאות:
- **USER** - מטפל רגיל (רואה רק את המטופלים שלו)
- **ADMIN** - מנהל (גישה לכל המערכת)

---

## 🚀 **מה צריך להשלים?**

### ⏳ **ממתין למידע חיצוני:**

1. **Twilio SMS**:
   - צריך: Account SID, Auth Token
   - איפה: [Twilio Console](https://console.twilio.com)
   - להוסיף ב: `src/lib/twilio.ts` (צריך ליצור)

2. **קופות חולים - API Keys**:
   - כללית: פנה למחלקת IT
   - מכבי: [Maccabi API Portal](https://api.maccabi.co.il)
   - מאוחדת: צור קשר עם תמיכה
   - לאומית: דרך פורטל הספקים

3. **אייקונים PWA**:
   - צריך: `icon-192.png`, `icon-512.png`
   - איפה לשים: `public/`
   - יצירה: [favicon.io](https://favicon.io)

### ✅ **תכונות שעובדות 100%:**
- ✅ PWA (התקנה, Offline)
- ✅ טפסי הסכמה + חתימה
- ✅ מבנה SMS (רק חסר Twilio)
- ✅ מבנה קופות חולים (רק חסר API Keys)
- ✅ ארגון תפריט חדש
- ✅ כל התכונות הקודמות

---

## 📞 **תמיכה והדרכה**

### 🎓 **מדריכים מהירים**:

#### איך לשלוח טופס הסכמה?
1. כלים קליניים → טפסי הסכמה
2. "צור תבנית חדשה"
3. בחר סוג (למשל "הסכם טיפול")
4. כתוב תוכן
5. שמור כתבנית
6. שלח למטופל ב-Email/SMS

#### איך להפעיל PWA?
1. פתח את האתר בנייד
2. תראה כפתור "התקן אפליקציה"
3. לחץ → אישור
4. האייקון יופיע במסך הבית

#### איך להגדיר תזכורות SMS?
1. הגדרות → תזכורות SMS
2. הפעל את המתג
3. בחר 24 שעות לפני (רגיל)
4. כתוב הודעה: "שלום {שם}, נתראה {תאריך} ב-{שעה}"
5. שמור

---

## 🎯 **סיכום הכל במילה אחת**

### מה היה?
❌ הצגת זמנים לא נכונה
❌ ייצוא מטופלים עם שגיאות

### מה יש עכשיו?
✅ PWA - אפליקציה להתקנה
✅ SMS - תזכורות אוטומטיות
✅ טפסים - הסכמות + חתימה
✅ קופות חולים - דיווח אוטומטי
✅ תפריט - מאורגן ופשוט

### איפה הכל?
📱 **יומיומי**: דשבורד → יומן → מטופלים → פגישות
🩺 **קליני**: הקלטות → שאלונים → טפסים → מסמכים
💰 **עסקי**: תשלומים → ביטולים → דוחות
⚙️ **הגדרות**: התראות → SMS → קופות חולים

---

**🎉 המערכת מוכנה לשימוש מלא!**
